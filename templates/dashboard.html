<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Pulse - å¥åº·å„€è¡¨æ¿</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+TC:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: #0a0a12;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* èƒŒæ™¯ç¶²æ ¼ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
        }
        
        /* æƒæç·š */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 3px
            );
            pointer-events: none;
            z-index: 1000;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* æ¨™é¡Œ */
        header {
            text-align: center;
            padding: 40px 0 30px;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #00f5ff, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
            letter-spacing: 4px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { filter: drop-shadow(0 0 10px rgba(0, 245, 255, 0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(255, 0, 128, 0.5)); }
        }
        
        .subtitle {
            color: #666;
            margin-top: 10px;
            font-size: 0.9rem;
            letter-spacing: 2px;
        }
        
        .date-display {
            font-family: 'Orbitron', sans-serif;
            color: #0ff;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        /* å¡ç‰‡å®¹å™¨ */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(15, 15, 25, 0.9);
            border: 1px solid;
            border-radius: 8px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--card-color), transparent);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px var(--card-glow);
        }
        
        .card.water { --card-color: #00f5ff; --card-glow: rgba(0, 245, 255, 0.3); border-color: rgba(0, 245, 255, 0.3); }
        .card.stand { --card-color: #39ff14; --card-glow: rgba(57, 255, 20, 0.3); border-color: rgba(57, 255, 20, 0.3); }
        .card.exercise { --card-color: #ff6b00; --card-glow: rgba(255, 107, 0, 0.3); border-color: rgba(255, 107, 0, 0.3); }
        .card.calories { --card-color: #ff0080; --card-glow: rgba(255, 0, 128, 0.3); border-color: rgba(255, 0, 128, 0.3); }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .card-label {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .card-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--card-color);
            text-shadow: 0 0 15px var(--card-glow);
        }
        
        .card-unit {
            font-size: 1rem;
            color: #666;
            margin-left: 5px;
        }
        
        /* åœ–è¡¨å€åŸŸ */
        .chart-section {
            background: rgba(15, 15, 25, 0.9);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .chart-title {
            font-family: 'Orbitron', sans-serif;
            color: #0ff;
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #0ff, #ff0080);
        }
        
        /* é€±çµ±è¨ˆé•·æ¢åœ– */
        .week-chart {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 200px;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .day-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 80px;
        }
        
        .bar-container {
            display: flex;
            gap: 4px;
            height: 150px;
            align-items: flex-end;
        }
        
        .bar {
            width: 16px;
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }
        
        .bar.water-bar { background: linear-gradient(180deg, #00f5ff, #0080ff); }
        .bar.stand-bar { background: linear-gradient(180deg, #39ff14, #00ff88); }
        .bar.exercise-bar { background: linear-gradient(180deg, #ff6b00, #ffaa00); }
        
        .bar:hover {
            filter: brightness(1.3);
        }
        
        .bar:hover::after {
            content: attr(data-value);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .day-label {
            margin-top: 10px;
            color: #888;
            font-size: 0.85rem;
        }
        
        .day-bar.today .day-label {
            color: #0ff;
            font-weight: bold;
        }
        
        /* åœ–ä¾‹ */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #888;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        
        .legend-color.water { background: linear-gradient(135deg, #00f5ff, #0080ff); }
        .legend-color.stand { background: linear-gradient(135deg, #39ff14, #00ff88); }
        .legend-color.exercise { background: linear-gradient(135deg, #ff6b00, #ffaa00); }
        
        /* è¨­å®šå€åŸŸ */
        .settings-section {
            background: rgba(15, 15, 25, 0.9);
            border: 1px solid rgba(136, 136, 255, 0.3);
            border-radius: 8px;
            padding: 25px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border-left: 3px solid #8888ff;
        }
        
        .setting-label {
            color: #aaa;
        }
        
        .setting-value {
            font-family: 'Orbitron', sans-serif;
            color: #8888ff;
        }
        
        /* è¼‰å…¥å‹•ç•« */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 255, 0.1);
            border-top-color: #0ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* RWD */
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .cards { grid-template-columns: repeat(2, 1fr); }
            .card-value { font-size: 2rem; }
            .bar { width: 12px; }
            .week-chart { height: 150px; }
            .bar-container { height: 100px; }
        }
        
        @media (max-width: 480px) {
            .cards { grid-template-columns: 1fr; }
            .legend { flex-wrap: wrap; gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš¡ NEON PULSE âš¡</h1>
            <p class="subtitle">å¥åº·ç®¡ç†å„€è¡¨æ¿</p>
            <p class="date-display" id="currentDate"></p>
        </header>
        
        <!-- ä»Šæ—¥çµ±è¨ˆå¡ç‰‡ -->
        <div class="cards" id="todayCards">
            <div class="loading"><div class="loading-spinner"></div></div>
        </div>
        
        <!-- é€±çµ±è¨ˆåœ–è¡¨ -->
        <div class="chart-section">
            <h2 class="chart-title">æœ¬é€±çµ±è¨ˆ</h2>
            <div class="week-chart" id="weekChart">
                <div class="loading"><div class="loading-spinner"></div></div>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color water"></div>
                    <span>å–æ°´ (æ¬¡)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color stand"></div>
                    <span>èµ·èº« (æ¬¡)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color exercise"></div>
                    <span>é‹å‹• (åˆ†é˜)</span>
                </div>
            </div>
        </div>
        
        <!-- è¨­å®šå€åŸŸ -->
        <div class="settings-section">
            <h2 class="chart-title">âš™ï¸ ç›®å‰è¨­å®š</h2>
            <div class="settings-grid" id="settingsGrid">
                <div class="loading"><div class="loading-spinner"></div></div>
            </div>
        </div>
    </div>

    <script>
        // é¡¯ç¤ºç•¶å‰æ—¥æœŸ
        function updateDate() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                weekday: 'long',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('zh-TW', options);
        }
        
        // è¼‰å…¥ä»Šæ—¥çµ±è¨ˆ
        async function loadTodayStats() {
            try {
                const res = await fetch('/api/today');
                const data = await res.json();
                
                document.getElementById('todayCards').innerHTML = `
                    <div class="card water">
                        <div class="card-icon">ğŸ’§</div>
                        <div class="card-label">ä»Šæ—¥å–æ°´</div>
                        <div class="card-value">${data.water_count}<span class="card-unit">æ¬¡</span></div>
                    </div>
                    <div class="card stand">
                        <div class="card-icon">ğŸ§</div>
                        <div class="card-label">ä»Šæ—¥èµ·èº«</div>
                        <div class="card-value">${data.stand_count}<span class="card-unit">æ¬¡</span></div>
                    </div>
                    <div class="card exercise">
                        <div class="card-icon">ğŸƒ</div>
                        <div class="card-label">ä»Šæ—¥é‹å‹•</div>
                        <div class="card-value">${data.exercise_minutes}<span class="card-unit">åˆ†é˜</span></div>
                    </div>
                    <div class="card calories">
                        <div class="card-icon">ğŸ”¥</div>
                        <div class="card-label">æ¶ˆè€—ç†±é‡</div>
                        <div class="card-value">${data.exercise_calories}<span class="card-unit">å¡</span></div>
                    </div>
                `;
            } catch (err) {
                console.error('è¼‰å…¥ä»Šæ—¥çµ±è¨ˆå¤±æ•—:', err);
                document.getElementById('todayCards').innerHTML = '<p style="color:#ff0080;">è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†</p>';
            }
        }
        
        // è¼‰å…¥é€±çµ±è¨ˆ
        async function loadWeekStats() {
            try {
                const res = await fetch('/api/week');
                const data = await res.json();
                
                // æ‰¾å‡ºæœ€å¤§å€¼ç”¨æ–¼è¨ˆç®—æ¯”ä¾‹
                const maxWater = Math.max(...data.map(d => d.water), 1);
                const maxStand = Math.max(...data.map(d => d.stand), 1);
                const maxExercise = Math.max(...data.map(d => d.exercise), 1);
                const maxHeight = 120; // æœ€å¤§é«˜åº¦ px
                
                const today = new Date().toISOString().split('T')[0];
                
                let html = '';
                data.forEach(day => {
                    const isToday = day.date === today;
                    const waterH = (day.water / maxWater) * maxHeight;
                    const standH = (day.stand / maxStand) * maxHeight;
                    const exerciseH = (day.exercise / maxExercise) * maxHeight;
                    
                    html += `
                        <div class="day-bar ${isToday ? 'today' : ''}">
                            <div class="bar-container">
                                <div class="bar water-bar" style="height:${waterH}px" data-value="${day.water}æ¬¡"></div>
                                <div class="bar stand-bar" style="height:${standH}px" data-value="${day.stand}æ¬¡"></div>
                                <div class="bar exercise-bar" style="height:${exerciseH}px" data-value="${day.exercise}åˆ†"></div>
                            </div>
                            <div class="day-label">${day.weekday}${isToday ? '(ä»Š)' : ''}</div>
                        </div>
                    `;
                });
                
                document.getElementById('weekChart').innerHTML = html;
            } catch (err) {
                console.error('è¼‰å…¥é€±çµ±è¨ˆå¤±æ•—:', err);
                document.getElementById('weekChart').innerHTML = '<p style="color:#ff0080;">è¼‰å…¥å¤±æ•—</p>';
            }
        }
        
        // è¼‰å…¥è¨­å®š
        async function loadSettings() {
            try {
                const res = await fetch('/api/settings');
                const data = await res.json();
                
                const status = data.enabled === 'TRUE' || data.enabled === true ? 'ğŸŸ¢ é–‹å•Ÿ' : 'ğŸ”´ é—œé–‰';
                
                document.getElementById('settingsGrid').innerHTML = `
                    <div class="setting-item">
                        <span class="setting-label">æé†’ç‹€æ…‹</span>
                        <span class="setting-value">${status}</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">ğŸ’§ å–æ°´é–“éš”</span>
                        <span class="setting-value">${data.water_interval || 60} åˆ†é˜</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">ğŸ§ ä¹…åé–“éš”</span>
                        <span class="setting-value">${data.stand_interval || 45} åˆ†é˜</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">ğŸŒ™ å‹¿æ“¾æ™‚æ®µ</span>
                        <span class="setting-value">${data.dnd_start || '22:00'} - ${data.dnd_end || '08:00'}</span>
                    </div>
                `;
            } catch (err) {
                console.error('è¼‰å…¥è¨­å®šå¤±æ•—:', err);
                document.getElementById('settingsGrid').innerHTML = '<p style="color:#ff0080;">è¼‰å…¥å¤±æ•—</p>';
            }
        }
        
        // åˆå§‹åŒ–
        updateDate();
        setInterval(updateDate, 60000);
        
        loadTodayStats();
        loadWeekStats();
        loadSettings();
        
        // æ¯ 5 åˆ†é˜è‡ªå‹•æ›´æ–°
        setInterval(() => {
            loadTodayStats();
            loadWeekStats();
        }, 300000);
    </script>
</body>
</html>
