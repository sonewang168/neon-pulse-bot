<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a12">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Neon Pulse">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/static/icon-192.png">
    <title>âš¡ Neon Pulse - å¥åº·è¿½è¹¤</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0a0a12;
            --bg-light: #1a1a2e;
            --cyan: #00f5ff;
            --green: #39ff14;
            --orange: #ff6b00;
            --pink: #ff0080;
            --purple: #8888ff;
            --yellow: #ffff00;
            --gold: #ffd700;
            --gray: #888888;
            --white: #ffffff;
            --red: #ff4444;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--white);
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #0a0a12 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--cyan);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 1.5rem;
            background: linear-gradient(90deg, var(--cyan), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .date {
            color: var(--gray);
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .header .streak {
            display: inline-block;
            background: var(--bg);
            border: 1px solid var(--orange);
            color: var(--orange);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        /* Main Content */
        .container {
            padding: 15px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--bg-light);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }
        
        .stat-card.water { border-color: var(--cyan); }
        .stat-card.stand { border-color: var(--green); }
        .stat-card.exercise { border-color: var(--orange); }
        .stat-card.calories { border-color: var(--pink); }
        
        .stat-card .icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .stat-card.water .value { color: var(--cyan); }
        .stat-card.stand .value { color: var(--green); }
        .stat-card.exercise .value { color: var(--orange); }
        .stat-card.calories .value { color: var(--pink); }
        
        .stat-card .label {
            color: var(--gray);
            font-size: 0.8rem;
            margin-top: 4px;
        }
        
        .stat-card .progress {
            margin-top: 10px;
            height: 6px;
            background: var(--bg);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .stat-card .progress-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .stat-card.water .progress-bar { background: var(--cyan); }
        .stat-card.stand .progress-bar { background: var(--green); }
        .stat-card.exercise .progress-bar { background: var(--orange); }
        
        .stat-card .goal {
            color: var(--gray);
            font-size: 0.7rem;
            text-align: right;
            margin-top: 4px;
        }
        
        /* Quick Actions */
        .actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .action-btn {
            background: var(--bg-light);
            border: 1px solid var(--gray);
            border-radius: 12px;
            padding: 15px 10px;
            color: var(--white);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        .action-btn.water { border-color: var(--cyan); }
        .action-btn.water:hover { background: rgba(0, 245, 255, 0.1); }
        
        .action-btn.stand { border-color: var(--green); }
        .action-btn.stand:hover { background: rgba(57, 255, 20, 0.1); }
        
        .action-btn.exercise { border-color: var(--orange); }
        .action-btn.exercise:hover { background: rgba(255, 107, 0, 0.1); }
        
        .action-btn .icon { font-size: 1.5rem; }
        
        /* Week Chart */
        .section-title {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .week-chart {
            background: var(--bg-light);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .week-bars {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 120px;
            padding: 10px 0;
        }
        
        .day-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        
        .day-bar .bars {
            display: flex;
            gap: 2px;
            align-items: flex-end;
            height: 80px;
        }
        
        .day-bar .bar {
            width: 8px;
            border-radius: 4px;
            transition: height 0.5s ease;
        }
        
        .day-bar .bar.water { background: var(--cyan); }
        .day-bar .bar.stand { background: var(--green); }
        .day-bar .bar.exercise { background: var(--orange); }
        
        .day-bar .weekday {
            margin-top: 8px;
            font-size: 0.7rem;
            color: var(--gray);
        }
        
        .day-bar.today .weekday {
            color: var(--cyan);
            font-weight: bold;
        }
        
        /* Weight Section */
        .weight-card {
            background: var(--bg-light);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid var(--purple);
            margin-bottom: 20px;
        }
        
        .weight-card .current {
            display: flex;
            align-items: baseline;
            gap: 5px;
        }
        
        .weight-card .current .value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--white);
        }
        
        .weight-card .current .unit {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .weight-card .changes {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .weight-card .change {
            font-size: 0.85rem;
        }
        
        .weight-card .change .label {
            color: var(--gray);
        }
        
        .weight-card .change .value.up { color: var(--red); }
        .weight-card .change .value.down { color: var(--green); }
        .weight-card .change .value.same { color: var(--gray); }
        
        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-light);
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--gray);
            text-decoration: none;
            font-size: 0.7rem;
            padding: 5px 15px;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .nav-item.active {
            color: var(--cyan);
        }
        
        .nav-item .icon {
            font-size: 1.3rem;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        
        .loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--bg-light);
            border-top-color: var(--cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-light);
            border: 1px solid var(--cyan);
            color: var(--white);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Refresh indicator */
        .refresh-time {
            text-align: center;
            color: var(--gray);
            font-size: 0.7rem;
            margin-top: 10px;
        }
        
        /* No data */
        .no-data {
            text-align: center;
            color: var(--gray);
            padding: 20px;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>âš¡ Neon Pulse</h1>
        <div class="date" id="currentDate">è¼‰å…¥ä¸­...</div>
        <div class="streak" id="streakBadge">ğŸ”¥ é€£çºŒ 0 å¤©</div>
    </header>
    
    <main class="container">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>è¼‰å…¥è³‡æ–™ä¸­...</div>
        </div>
        
        <div id="content" style="display: none;">
            <!-- Today Stats -->
            <div class="stats-grid">
                <div class="stat-card water">
                    <div class="icon">ğŸ’§</div>
                    <div class="value" id="waterCount">0</div>
                    <div class="label">æ¯æ°´</div>
                    <div class="progress">
                        <div class="progress-bar" id="waterProgress" style="width: 0%"></div>
                    </div>
                    <div class="goal">ç›®æ¨™ 8 æ¯</div>
                </div>
                
                <div class="stat-card stand">
                    <div class="icon">ğŸ§</div>
                    <div class="value" id="standCount">0</div>
                    <div class="label">æ¬¡èµ·èº«</div>
                    <div class="progress">
                        <div class="progress-bar" id="standProgress" style="width: 0%"></div>
                    </div>
                    <div class="goal">ç›®æ¨™ 6 æ¬¡</div>
                </div>
                
                <div class="stat-card exercise">
                    <div class="icon">ğŸƒ</div>
                    <div class="value" id="exerciseMinutes">0</div>
                    <div class="label">åˆ†é˜é‹å‹•</div>
                    <div class="progress">
                        <div class="progress-bar" id="exerciseProgress" style="width: 0%"></div>
                    </div>
                    <div class="goal">ç›®æ¨™ 30 åˆ†é˜</div>
                </div>
                
                <div class="stat-card calories">
                    <div class="icon">ğŸ”¥</div>
                    <div class="value" id="caloriesBurned">0</div>
                    <div class="label">å¤§å¡æ¶ˆè€—</div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="section-title">âš¡ å¿«é€Ÿè¨˜éŒ„</div>
            <div class="actions">
                <button class="action-btn water" onclick="logWater()">
                    <span class="icon">ğŸ’§</span>
                    <span>å–æ°´</span>
                </button>
                <button class="action-btn stand" onclick="logStand()">
                    <span class="icon">ğŸ§</span>
                    <span>èµ·èº«</span>
                </button>
                <button class="action-btn exercise" onclick="showExercise()">
                    <span class="icon">ğŸƒ</span>
                    <span>é‹å‹•</span>
                </button>
            </div>
            
            <!-- Week Chart -->
            <div class="section-title">ğŸ“… æœ¬é€±çµ±è¨ˆ</div>
            <div class="week-chart">
                <div class="week-bars" id="weekBars">
                    <!-- Dynamic content -->
                </div>
            </div>
            
            <!-- Weight -->
            <div class="section-title">âš–ï¸ é«”é‡è¿½è¹¤</div>
            <div class="weight-card" id="weightCard">
                <div class="current">
                    <span class="value" id="weightValue">--</span>
                    <span class="unit">kg</span>
                </div>
                <div class="changes">
                    <div class="change">
                        <span class="label">é€±è®ŠåŒ–ï¼š</span>
                        <span class="value same" id="weightWeek">--</span>
                    </div>
                    <div class="change">
                        <span class="label">æœˆè®ŠåŒ–ï¼š</span>
                        <span class="value same" id="weightMonth">--</span>
                    </div>
                </div>
            </div>
            
            <div class="refresh-time" id="refreshTime">æœ€å¾Œæ›´æ–°ï¼š--</div>
        </div>
    </main>
    
    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <span class="icon">ğŸ“Š</span>
            <span>ä»Šæ—¥</span>
        </a>
        <a href="#" class="nav-item" onclick="loadWeek()">
            <span class="icon">ğŸ“…</span>
            <span>é€±å ±</span>
        </a>
        <a href="#" class="nav-item" onclick="showWeightInput()">
            <span class="icon">âš–ï¸</span>
            <span>é«”é‡</span>
        </a>
        <a href="#" class="nav-item" onclick="loadSettings()">
            <span class="icon">âš™ï¸</span>
            <span>è¨­å®š</span>
        </a>
    </nav>
    
    <div class="toast" id="toast"></div>
    
    <script>
        // API Base URL
        const API = '';
        
        // Load data
        async function loadData() {
            try {
                const [todayRes, weekRes, weightRes, streakRes] = await Promise.all([
                    fetch(`${API}/api/today`),
                    fetch(`${API}/api/week`),
                    fetch(`${API}/api/weight`),
                    fetch(`${API}/api/streak`)
                ]);
                
                const today = await todayRes.json();
                const week = await weekRes.json();
                const weight = await weightRes.json();
                const streak = await streakRes.json();
                
                updateUI(today, week, weight, streak);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (err) {
                console.error('Load error:', err);
                document.getElementById('loading').innerHTML = '<div class="no-data">âš ï¸ ç„¡æ³•è¼‰å…¥è³‡æ–™<br><small>è«‹ç¢ºèªç¶²è·¯é€£ç·š</small></div>';
            }
        }
        
        function updateUI(today, week, weight, streak) {
            // Date
            const now = new Date();
            document.getElementById('currentDate').textContent = 
                `${now.getMonth() + 1}/${now.getDate()} ${['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][now.getDay()]}`;
            
            // Streak
            document.getElementById('streakBadge').textContent = `ğŸ”¥ é€£çºŒ ${streak.streak || 0} å¤©`;
            
            // Today stats
            document.getElementById('waterCount').textContent = today.water_count || 0;
            document.getElementById('standCount').textContent = today.stand_count || 0;
            document.getElementById('exerciseMinutes').textContent = today.exercise_minutes || 0;
            document.getElementById('caloriesBurned').textContent = today.exercise_calories || 0;
            
            // Progress bars
            document.getElementById('waterProgress').style.width = Math.min((today.water_count || 0) / 8 * 100, 100) + '%';
            document.getElementById('standProgress').style.width = Math.min((today.stand_count || 0) / 6 * 100, 100) + '%';
            document.getElementById('exerciseProgress').style.width = Math.min((today.exercise_minutes || 0) / 30 * 100, 100) + '%';
            
            // Week chart
            renderWeekChart(week);
            
            // Weight
            if (weight && weight.current) {
                document.getElementById('weightValue').textContent = weight.current;
                
                const weekChange = weight.week_change;
                const weekEl = document.getElementById('weightWeek');
                if (weekChange !== null && weekChange !== undefined) {
                    weekEl.textContent = weekChange > 0 ? `+${weekChange}` : weekChange;
                    weekEl.className = 'value ' + (weekChange > 0 ? 'up' : weekChange < 0 ? 'down' : 'same');
                }
                
                const monthChange = weight.month_change;
                const monthEl = document.getElementById('weightMonth');
                if (monthChange !== null && monthChange !== undefined) {
                    monthEl.textContent = monthChange > 0 ? `+${monthChange}` : monthChange;
                    monthEl.className = 'value ' + (monthChange > 0 ? 'up' : monthChange < 0 ? 'down' : 'same');
                }
            }
            
            // Refresh time
            document.getElementById('refreshTime').textContent = `æœ€å¾Œæ›´æ–°ï¼š${now.toLocaleTimeString('zh-TW')}`;
        }
        
        function renderWeekChart(week) {
            const container = document.getElementById('weekBars');
            const today = new Date().getDay();
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            
            // Reorder to start from Monday
            const orderedWeek = week || [];
            
            let html = '';
            orderedWeek.forEach((day, i) => {
                const isToday = day.weekday === weekdays[today] || 
                               (today === 0 && day.weekday === 'æ—¥') ||
                               (today === 1 && day.weekday === 'ä¸€') ||
                               (today === 2 && day.weekday === 'äºŒ') ||
                               (today === 3 && day.weekday === 'ä¸‰') ||
                               (today === 4 && day.weekday === 'å››') ||
                               (today === 5 && day.weekday === 'äº”') ||
                               (today === 6 && day.weekday === 'å…­');
                
                const waterH = Math.min((day.water || 0) / 8 * 60, 60);
                const standH = Math.min((day.stand || 0) / 6 * 60, 60);
                const exerciseH = Math.min((day.exercise || 0) / 30 * 60, 60);
                
                html += `
                    <div class="day-bar ${day.date === new Date().toISOString().slice(0,10) ? 'today' : ''}">
                        <div class="bars">
                            <div class="bar water" style="height: ${waterH}px"></div>
                            <div class="bar stand" style="height: ${standH}px"></div>
                            <div class="bar exercise" style="height: ${exerciseH}px"></div>
                        </div>
                        <div class="weekday">${day.weekday}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Actions
        async function logWater() {
            showToast('ğŸ’§ è¨˜éŒ„ä¸­...');
            // Note: This would need backend API support for web logging
            // For now just refresh data
            setTimeout(() => {
                showToast('è«‹ä½¿ç”¨ LINE Bot è¨˜éŒ„');
            }, 500);
        }
        
        async function logStand() {
            showToast('ğŸ§ è¨˜éŒ„ä¸­...');
            setTimeout(() => {
                showToast('è«‹ä½¿ç”¨ LINE Bot è¨˜éŒ„');
            }, 500);
        }
        
        function showExercise() {
            showToast('è«‹ä½¿ç”¨ LINE Bot è¨˜éŒ„é‹å‹•');
        }
        
        function showWeightInput() {
            const weight = prompt('è«‹è¼¸å…¥é«”é‡ (kg)ï¼š');
            if (weight && !isNaN(weight)) {
                showToast('è«‹åœ¨ LINE Bot è¼¸å…¥ï¼šé«”é‡ ' + weight);
            }
        }
        
        function loadWeek() {
            showToast('è«‹åœ¨ LINE Bot è¼¸å…¥ï¼šé€±å ±');
        }
        
        function loadSettings() {
            showToast('è«‹åœ¨ LINE Bot è¼¸å…¥ï¼šè¨­å®š');
        }
        
        // Toast
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        // Pull to refresh
        let startY = 0;
        document.addEventListener('touchstart', e => startY = e.touches[0].pageY);
        document.addEventListener('touchend', e => {
            if (window.scrollY === 0 && e.changedTouches[0].pageY - startY > 100) {
                showToast('ğŸ”„ é‡æ–°è¼‰å…¥...');
                loadData();
            }
        });
        
        // Auto refresh every 60 seconds
        setInterval(loadData, 60000);
        
        // Initial load
        loadData();
        
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
        }
    </script>
</body>
</html>
