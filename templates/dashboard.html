<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a12">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>âš¡ Neon Pulse</title>
    <link rel="manifest" href="/manifest.json">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#0a0a12;--bg2:#1a1a2e;--cyan:#00f5ff;--green:#39ff14;--orange:#ff6b00;--pink:#ff0080;--purple:#9966ff;--gold:#ffd700;--gray:#888;--white:#fff;--red:#ff4444}
        body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--white);min-height:100vh;padding-bottom:70px}
        .header{background:linear-gradient(135deg,#1a1a2e,#0a0a12);padding:12px 15px;text-align:center;border-bottom:1px solid var(--cyan);position:sticky;top:0;z-index:100}
        .header h1{font-size:1.2rem;background:linear-gradient(90deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .header .sub{display:flex;justify-content:center;gap:15px;margin-top:5px}
        .header .date{color:var(--gray);font-size:0.75rem}
        .header .streak{background:var(--bg);border:1px solid var(--orange);color:var(--orange);padding:2px 8px;border-radius:12px;font-size:0.7rem}
        .container{padding:12px;max-width:500px;margin:0 auto}
        .tabs{display:flex;background:var(--bg2);border-radius:8px;margin-bottom:12px;overflow-x:auto}
        .tab{flex:0 0 auto;padding:8px 12px;color:var(--gray);cursor:pointer;font-size:0.75rem;white-space:nowrap;transition:all 0.2s}
        .tab.active{background:var(--cyan);color:var(--bg);font-weight:bold;border-radius:8px}
        .tab-content{display:none}.tab-content.active{display:block}
        .stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px}
        .stats-grid.three{grid-template-columns:repeat(3,1fr)}
        .stat-card{background:var(--bg2);border-radius:10px;padding:10px;border:1px solid transparent;cursor:pointer;transition:all 0.2s}
        .stat-card:active{transform:scale(0.98)}
        .stat-card.water{border-color:var(--cyan)}.stat-card.stand{border-color:var(--green)}.stat-card.exercise{border-color:var(--orange)}.stat-card.calories{border-color:var(--pink)}
        .stat-card.sleep{border-color:var(--purple)}.stat-card.meal{border-color:var(--gold)}.stat-card.mood{border-color:var(--pink)}
        .stat-card .icon{font-size:1.3rem}.stat-card .value{font-size:1.5rem;font-weight:bold}
        .stat-card.water .value{color:var(--cyan)}.stat-card.stand .value{color:var(--green)}.stat-card.exercise .value{color:var(--orange)}.stat-card.calories .value{color:var(--pink)}
        .stat-card.sleep .value{color:var(--purple)}.stat-card.meal .value{color:var(--gold)}.stat-card.mood .value{color:var(--pink)}
        .stat-card .label{color:var(--gray);font-size:0.65rem}
        .stat-card .progress{margin-top:5px;height:4px;background:var(--bg);border-radius:2px;overflow:hidden}
        .stat-card .progress-bar{height:100%;border-radius:2px;transition:width 0.3s}
        .stat-card.water .progress-bar{background:var(--cyan)}.stat-card.stand .progress-bar{background:var(--green)}.stat-card.exercise .progress-bar{background:var(--orange)}
        .actions{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px}
        .action-btn{background:var(--bg2);border:1px solid var(--gray);border-radius:8px;padding:8px 4px;color:var(--white);font-size:0.65rem;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:3px;transition:all 0.2s}
        .action-btn:active{transform:scale(0.95)}.action-btn:disabled{opacity:0.5}
        .action-btn .icon{font-size:1.1rem}
        .section{background:var(--bg2);border-radius:10px;padding:12px;margin-bottom:12px}
        .section-title{color:var(--gray);font-size:0.75rem;margin-bottom:8px;display:flex;justify-content:space-between}
        .form-group{margin-bottom:10px}
        .form-label{color:var(--gray);font-size:0.7rem;margin-bottom:4px;display:block}
        .form-input{width:100%;padding:8px;background:var(--bg);border:1px solid #333;border-radius:6px;color:var(--white);font-size:0.85rem}
        .form-input:focus{outline:none;border-color:var(--cyan)}
        .form-row{display:flex;gap:8px}.form-row .form-group{flex:1}
        select.form-input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23888' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center}
        .btn{width:100%;padding:10px;border:none;border-radius:6px;font-size:0.85rem;cursor:pointer;transition:all 0.2s}
        .btn:active{transform:scale(0.98)}
        .btn-primary{background:var(--cyan);color:var(--bg)}.btn-success{background:var(--green);color:var(--bg)}.btn-warning{background:var(--orange);color:var(--bg)}.btn-secondary{background:var(--bg);color:var(--white);border:1px solid var(--gray)}
        .btn-purple{background:var(--purple);color:var(--white)}.btn-pink{background:var(--pink);color:var(--white)}.btn-gold{background:var(--gold);color:var(--bg)}
        .toggle-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0}
        .toggle{width:44px;height:24px;background:#333;border-radius:12px;position:relative;cursor:pointer}
        .toggle.on{background:var(--green)}
        .toggle::after{content:'';position:absolute;width:20px;height:20px;background:var(--white);border-radius:50%;top:2px;left:2px;transition:all 0.2s}
        .toggle.on::after{left:22px}
        .badge{display:inline-flex;align-items:center;gap:5px;background:var(--bg);border:1px solid var(--gold);color:var(--gold);padding:5px 10px;border-radius:15px;font-size:0.7rem;margin:3px}
        .mood-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
        .mood-btn{background:var(--bg);border:1px solid #333;border-radius:8px;padding:10px;font-size:1.5rem;cursor:pointer;transition:all 0.2s}
        .mood-btn:active{transform:scale(0.95)}
        .mood-btn.selected{border-color:var(--pink);background:var(--bg2)}
        .meal-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #333}
        .meal-item:last-child{border-bottom:none}
        .week-bars{display:flex;justify-content:space-between;height:70px;padding:5px 0}
        .day-bar{display:flex;flex-direction:column;align-items:center;flex:1}
        .day-bar .bars{display:flex;gap:2px;align-items:flex-end;height:45px}
        .day-bar .bar{width:4px;border-radius:2px}
        .day-bar .bar.water{background:var(--cyan)}.day-bar .bar.stand{background:var(--green)}.day-bar .bar.exercise{background:var(--orange)}
        .day-bar .weekday{margin-top:3px;font-size:0.55rem;color:var(--gray)}
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg2);border-top:1px solid #333;display:flex;justify-content:space-around;padding:5px 0;padding-bottom:max(5px,env(safe-area-inset-bottom))}
        .nav-item{display:flex;flex-direction:column;align-items:center;color:var(--gray);font-size:0.55rem;padding:3px 6px;cursor:pointer}
        .nav-item.active{color:var(--cyan)}
        .nav-item .icon{font-size:1rem;margin-bottom:1px}
        .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--bg2);border:1px solid var(--cyan);color:var(--white);padding:8px 16px;border-radius:16px;font-size:0.8rem;opacity:0;transition:opacity 0.3s;z-index:1000}
        .toast.show{opacity:1}.toast.error{border-color:var(--red)}.toast.success{border-color:var(--green)}
        .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:200}
        .modal.show{display:flex}
        .modal-content{background:var(--bg2);border-radius:12px;padding:16px;width:90%;max-width:350px;max-height:80vh;overflow-y:auto}
        .modal-title{font-size:1rem;margin-bottom:12px;text-align:center}
        .loading{text-align:center;padding:40px;color:var(--gray)}
        .spinner{width:36px;height:36px;border:3px solid var(--bg2);border-top-color:var(--cyan);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 12px}
        @keyframes spin{to{transform:rotate(360deg)}}
        .refresh-time{text-align:center;color:var(--gray);font-size:0.6rem;margin-top:8px}
    </style>
</head>
<body>
    <header class="header">
        <h1>âš¡ Neon Pulse</h1>
        <div class="sub"><span class="date" id="currentDate">è¼‰å…¥ä¸­...</span><span class="streak" id="streakBadge">ğŸ”¥ 0å¤©</span></div>
    </header>
    <main class="container">
        <div id="loading" class="loading"><div class="spinner"></div><div>è¼‰å…¥ä¸­...</div></div>
        <div id="content" style="display:none">
            <div class="tabs">
                <div class="tab active" data-tab="home">ğŸ“Šé¦–é </div>
                <div class="tab" data-tab="record">âœï¸è¨˜éŒ„</div>
                <div class="tab" data-tab="health">â¤ï¸å¥åº·</div>
                <div class="tab" data-tab="achieve">ğŸ†æˆå°±</div>
                <div class="tab" data-tab="settings">âš™ï¸è¨­å®š</div>
            </div>
            
            <!-- é¦–é  -->
            <div id="tab-home" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card water" onclick="quickLog('water')"><div class="icon">ğŸ’§</div><div class="value" id="waterCount">0</div><div class="label">/ <span id="waterGoal">8</span> æ¯</div><div class="progress"><div class="progress-bar" id="waterProg"></div></div></div>
                    <div class="stat-card stand" onclick="quickLog('stand')"><div class="icon">ğŸ§</div><div class="value" id="standCount">0</div><div class="label">/ <span id="standGoal">6</span> æ¬¡</div><div class="progress"><div class="progress-bar" id="standProg"></div></div></div>
                    <div class="stat-card exercise" onclick="showModal('exerciseModal')"><div class="icon">ğŸƒ</div><div class="value" id="exerciseMin">0</div><div class="label">/ <span id="exerciseGoal">30</span> åˆ†é˜</div><div class="progress"><div class="progress-bar" id="exerciseProg"></div></div></div>
                    <div class="stat-card calories"><div class="icon">ğŸ”¥</div><div class="value" id="caloriesBurn">0</div><div class="label">å¤§å¡æ¶ˆè€—</div></div>
                </div>
                <div class="actions">
                    <button class="action-btn" onclick="quickLog('water')"><span class="icon">ğŸ’§</span>å–æ°´</button>
                    <button class="action-btn" onclick="quickLog('stand')"><span class="icon">ğŸ§</span>èµ·èº«</button>
                    <button class="action-btn" onclick="showModal('exerciseModal')"><span class="icon">ğŸƒ</span>é‹å‹•</button>
                    <button class="action-btn" onclick="showModal('moodModal')"><span class="icon">ğŸ˜Š</span>å¿ƒæƒ…</button>
                </div>
                <div class="stats-grid three">
                    <div class="stat-card sleep" onclick="showModal('sleepModal')"><div class="icon">ğŸ˜´</div><div class="value" id="sleepHrs">-</div><div class="label">å°æ™‚</div></div>
                    <div class="stat-card meal" onclick="showModal('mealModal')"><div class="icon">ğŸ</div><div class="value" id="mealCal">0</div><div class="label">å¡æ”å…¥</div></div>
                    <div class="stat-card mood"><div class="icon" id="moodEmoji">ğŸ˜Š</div><div class="value" id="moodScore">-</div><div class="label">å¿ƒæƒ…</div></div>
                </div>
                <div class="section"><div class="section-title">ğŸ“… æœ¬é€±çµ±è¨ˆ</div><div class="week-bars" id="weekBars"></div></div>
                <div class="section"><div class="section-title">âš–ï¸ é«”é‡ <span id="weightVal">--</span> kg</div><button class="btn btn-secondary" onclick="showModal('weightModal')">ğŸ“ è¨˜éŒ„é«”é‡</button></div>
                <div class="refresh-time" id="refreshTime">ä¸‹æ‹‰åˆ·æ–°</div>
            </div>
            
            <!-- è¨˜éŒ„ -->
            <div id="tab-record" class="tab-content">
                <div class="section">
                    <div class="section-title">ğŸ˜´ ç¡çœ è¨˜éŒ„</div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">æ™‚æ•¸</label><input type="number" class="form-input" id="sleepInput" step="0.5" placeholder="7.5"></div>
                        <div class="form-group"><label class="form-label">å“è³ª(1-5)</label><input type="number" class="form-input" id="sleepQuality" min="1" max="5" placeholder="4"></div>
                    </div>
                    <button class="btn btn-purple" onclick="logSleep()">è¨˜éŒ„ç¡çœ </button>
                </div>
                
                <div class="section">
                    <div class="section-title">ğŸ é£²é£Ÿè¨˜éŒ„ï¼ˆè‡ªå‹•è¨ˆç®—ç†±é‡ï¼‰</div>
                    <div class="form-group"><label class="form-label">é¤åˆ¥</label>
                        <select class="form-input" id="mealType">
                            <option value="æ—©é¤">ğŸŒ…æ—©é¤</option>
                            <option value="åˆé¤">â˜€ï¸åˆé¤</option>
                            <option value="æ™šé¤">ğŸŒ™æ™šé¤</option>
                            <option value="é»å¿ƒ">ğŸªé»å¿ƒ</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">é£Ÿç‰©ï¼ˆé€—è™Ÿæˆ–ç©ºæ ¼åˆ†éš”ï¼‰</label><input type="text" class="form-input" id="mealFoods" placeholder="éºµåŒ… è±†æ¼¿"></div>
                    <div class="form-group"><label class="form-label">ç†±é‡ï¼ˆé¸å¡«ï¼Œç•™ç©ºè‡ªå‹•è¨ˆç®—ï¼‰</label><input type="number" class="form-input" id="mealCalInput" placeholder="è‡ªå‹•è¨ˆç®—"></div>
                    <button class="btn btn-gold" onclick="logMeal()">è¨˜éŒ„é£²é£Ÿ</button>
                </div>
                
                <div class="section">
                    <div class="section-title">ğŸƒ é‹å‹•è¨˜éŒ„</div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">é¡å‹</label>
                            <select class="form-input" id="exType">
                                <option value="è·‘æ­¥">ğŸƒè·‘æ­¥</option>
                                <option value="èµ°è·¯">ğŸš¶èµ°è·¯</option>
                                <option value="æ¸¸æ³³">ğŸŠæ¸¸æ³³</option>
                                <option value="é¨è»Š">ğŸš´é¨è»Š</option>
                                <option value="é‡è¨“">ğŸ‹ï¸é‡è¨“</option>
                                <option value="ç‘œä¼½">ğŸ§˜ç‘œä¼½</option>
                                <option value="å…¶ä»–">â­å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="form-group"><label class="form-label">åˆ†é˜</label><input type="number" class="form-input" id="exDuration" value="30"></div>
                    </div>
                    <button class="btn btn-warning" onclick="logExercise()">è¨˜éŒ„é‹å‹•</button>
                </div>
                
                <div class="section">
                    <div class="section-title">âœï¸ ä¿®æ”¹ä»Šæ—¥æ•¸æ“š</div>
                    <div class="form-group">
                        <label class="form-label">ğŸ’§ å–æ°´æ¯æ•¸</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="inputModifyWater" min="0">
                            <button class="btn btn-primary" style="width:80px" onclick="modifyWater()">ä¿®æ”¹</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ§ èµ·èº«æ¬¡æ•¸</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="inputModifyStand" min="0">
                            <button class="btn btn-success" style="width:80px" onclick="modifyStand()">ä¿®æ”¹</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å¥åº· -->
            <div id="tab-health" class="tab-content">
                <div class="section">
                    <div class="section-title">ğŸ˜Š è¨˜éŒ„å¿ƒæƒ…</div>
                    <div class="mood-grid" id="moodGrid">
                        <div class="mood-btn" data-mood="ğŸ˜„" onclick="selectMood('ğŸ˜„')">ğŸ˜„</div>
                        <div class="mood-btn" data-mood="ğŸ™‚" onclick="selectMood('ğŸ™‚')">ğŸ™‚</div>
                        <div class="mood-btn" data-mood="ğŸ˜" onclick="selectMood('ğŸ˜')">ğŸ˜</div>
                        <div class="mood-btn" data-mood="ğŸ˜”" onclick="selectMood('ğŸ˜”')">ğŸ˜”</div>
                        <div class="mood-btn" data-mood="ğŸ˜¢" onclick="selectMood('ğŸ˜¢')">ğŸ˜¢</div>
                        <div class="mood-btn" data-mood="ğŸ˜¡" onclick="selectMood('ğŸ˜¡')">ğŸ˜¡</div>
                        <div class="mood-btn" data-mood="ğŸ˜°" onclick="selectMood('ğŸ˜°')">ğŸ˜°</div>
                        <div class="mood-btn" data-mood="ğŸ˜´" onclick="selectMood('ğŸ˜´')">ğŸ˜´</div>
                    </div>
                    <div class="form-group" style="margin-top:10px"><input type="text" class="form-input" id="moodNote" placeholder="å‚™è¨»"></div>
                    <button class="btn btn-pink" onclick="logMood()">è¨˜éŒ„å¿ƒæƒ…</button>
                </div>
                <div class="section"><div class="section-title">ğŸ˜´ ç¡çœ çµ±è¨ˆ</div><div id="sleepStats">è¼‰å…¥ä¸­...</div></div>
                <div class="section"><div class="section-title">ğŸ ä»Šæ—¥é£²é£Ÿ</div><div id="mealList">è¼‰å…¥ä¸­...</div></div>
                <div class="section"><div class="section-title">ğŸ˜Š å¿ƒæƒ…çµ±è¨ˆ</div><div id="moodStats">è¼‰å…¥ä¸­...</div></div>
            </div>
            
            <!-- æˆå°± -->
            <div id="tab-achieve" class="tab-content">
                <div class="section"><div class="section-title">ğŸ† å·²è§£é– <span id="achieveCount">0/0</span></div><div id="achieveList"></div></div>
                <div class="section"><div class="section-title">ğŸ“Š ç´¯è¨ˆçµ±è¨ˆ</div><div id="totalStats"></div></div>
            </div>
            
            <!-- è¨­å®š -->
            <div id="tab-settings" class="tab-content">
                <div class="section">
                    <div class="section-title">ğŸ¯ æ¯æ—¥ç›®æ¨™</div>
                    <div class="form-group"><label class="form-label">ğŸ’§ å–æ°´ï¼ˆæ¯ï¼‰</label><input type="number" class="form-input" id="setWaterGoal" min="1" max="20"></div>
                    <div class="form-group"><label class="form-label">ğŸ§ èµ·èº«ï¼ˆæ¬¡ï¼‰</label><input type="number" class="form-input" id="setStandGoal" min="1" max="20"></div>
                    <div class="form-group"><label class="form-label">ğŸƒ é‹å‹•ï¼ˆåˆ†é˜ï¼‰</label><input type="number" class="form-input" id="setExGoal" min="1" max="180"></div>
                    <button class="btn btn-primary" onclick="saveGoals()">å„²å­˜ç›®æ¨™</button>
                </div>
                <div class="section">
                    <div class="section-title">â° æé†’è¨­å®š</div>
                    <div class="toggle-row"><span>æé†’åŠŸèƒ½</span><div class="toggle" id="toggleEnabled" onclick="toggleEnabled()"></div></div>
                    <div class="form-group" style="margin-top:10px"><label class="form-label">ğŸ’§ å–æ°´é–“éš”ï¼ˆåˆ†ï¼‰</label><input type="number" class="form-input" id="setWaterInt" min="10" max="180"></div>
                    <div class="form-group"><label class="form-label">ğŸ§ èµ·èº«é–“éš”ï¼ˆåˆ†ï¼‰</label><input type="number" class="form-input" id="setStandInt" min="10" max="120"></div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">ğŸŒ™ å‹¿æ“¾é–‹å§‹</label><input type="time" class="form-input" id="setDndStart"></div>
                        <div class="form-group"><label class="form-label">ğŸŒ™ å‹¿æ“¾çµæŸ</label><input type="time" class="form-input" id="setDndEnd"></div>
                    </div>
                    <button class="btn btn-secondary" onclick="saveSettings()">å„²å­˜è¨­å®š</button>
                </div>
            </div>
        </div>
    </main>
    
    <nav class="bottom-nav">
        <div class="nav-item active" data-tab="home"><span class="icon">ğŸ“Š</span>é¦–é </div>
        <div class="nav-item" data-tab="record"><span class="icon">âœï¸</span>è¨˜éŒ„</div>
        <div class="nav-item" data-tab="health"><span class="icon">â¤ï¸</span>å¥åº·</div>
        <div class="nav-item" data-tab="achieve"><span class="icon">ğŸ†</span>æˆå°±</div>
        <div class="nav-item" data-tab="settings"><span class="icon">âš™ï¸</span>è¨­å®š</div>
    </nav>
    
    <!-- Modals -->
    <div class="modal" id="exerciseModal"><div class="modal-content"><div class="modal-title">ğŸƒ å¿«é€Ÿé‹å‹•</div><div class="form-group"><select class="form-input" id="qExType"><option value="è·‘æ­¥">ğŸƒè·‘æ­¥</option><option value="èµ°è·¯">ğŸš¶èµ°è·¯</option><option value="é‡è¨“">ğŸ‹ï¸é‡è¨“</option><option value="å…¶ä»–">â­å…¶ä»–</option></select></div><div class="form-group"><input type="number" class="form-input" id="qExDur" value="30" placeholder="åˆ†é˜"></div><div class="form-row"><button class="btn btn-secondary" onclick="closeModal('exerciseModal')">å–æ¶ˆ</button><button class="btn btn-warning" onclick="qLogExercise()">è¨˜éŒ„</button></div></div></div>
    <div class="modal" id="moodModal"><div class="modal-content"><div class="modal-title">ğŸ˜Š å¿«é€Ÿå¿ƒæƒ…</div><div class="mood-grid"><div class="mood-btn" onclick="qLogMood('ğŸ˜„')">ğŸ˜„</div><div class="mood-btn" onclick="qLogMood('ğŸ™‚')">ğŸ™‚</div><div class="mood-btn" onclick="qLogMood('ğŸ˜')">ğŸ˜</div><div class="mood-btn" onclick="qLogMood('ğŸ˜”')">ğŸ˜”</div></div><button class="btn btn-secondary" style="margin-top:10px" onclick="closeModal('moodModal')">å–æ¶ˆ</button></div></div>
    <div class="modal" id="sleepModal"><div class="modal-content"><div class="modal-title">ğŸ˜´ å¿«é€Ÿç¡çœ </div><div class="form-row"><div class="form-group"><label class="form-label">æ™‚æ•¸</label><input type="number" class="form-input" id="qSleepH" step="0.5" placeholder="7.5"></div><div class="form-group"><label class="form-label">å“è³ª</label><input type="number" class="form-input" id="qSleepQ" min="1" max="5" placeholder="4"></div></div><div class="form-row"><button class="btn btn-secondary" onclick="closeModal('sleepModal')">å–æ¶ˆ</button><button class="btn btn-purple" onclick="qLogSleep()">è¨˜éŒ„</button></div></div></div>
    <div class="modal" id="mealModal"><div class="modal-content"><div class="modal-title">ğŸ å¿«é€Ÿé£²é£Ÿï¼ˆè‡ªå‹•è¨ˆç®—ç†±é‡ï¼‰</div><div class="form-group"><select class="form-input" id="qMealType"><option value="æ—©é¤">ğŸŒ…æ—©é¤</option><option value="åˆé¤">â˜€ï¸åˆé¤</option><option value="æ™šé¤">ğŸŒ™æ™šé¤</option><option value="é»å¿ƒ">ğŸªé»å¿ƒ</option></select></div><div class="form-group"><input type="text" class="form-input" id="qMealFoods" placeholder="é£Ÿç‰©ï¼ˆç©ºæ ¼æˆ–é€—è™Ÿåˆ†éš”ï¼‰"></div><div class="form-row"><button class="btn btn-secondary" onclick="closeModal('mealModal')">å–æ¶ˆ</button><button class="btn btn-gold" onclick="qLogMeal()">è¨˜éŒ„</button></div></div></div>
    <div class="modal" id="weightModal"><div class="modal-content"><div class="modal-title">âš–ï¸ è¨˜éŒ„é«”é‡</div><div class="form-group"><input type="number" class="form-input" id="qWeight" step="0.1" placeholder="kg"></div><div class="form-row"><button class="btn btn-secondary" onclick="closeModal('weightModal')">å–æ¶ˆ</button><button class="btn btn-primary" onclick="qLogWeight()">è¨˜éŒ„</button></div></div></div>
    <div class="toast" id="toast"></div>
    
    <script>
        const API = '';
        let goals = {water:8, stand:6, exercise:30};
        let settings = {};
        let selectedMood = 'ğŸ˜Š';
        
        // Tab Navigation
        document.querySelectorAll('.tab,.nav-item[data-tab]').forEach(el => {
            el.addEventListener('click', () => {
                const tab = el.dataset.tab;
                if (!tab) return;
                document.querySelectorAll('.tab,.nav-item').forEach(x => x.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
                document.querySelectorAll(`[data-tab="${tab}"]`).forEach(x => x.classList.add('active'));
                document.getElementById(`tab-${tab}`).classList.add('active');
            });
        });
        
        async function loadData() {
            try {
                const [today, week, weight, streak, goalsR, settingsR, sleep, meal, mood, achieve] = await Promise.all([
                    fetch(`${API}/api/today`).then(r => r.json()).catch(() => ({})),
                    fetch(`${API}/api/week`).then(r => r.json()).catch(() => []),
                    fetch(`${API}/api/weight`).then(r => r.json()).catch(() => ({})),
                    fetch(`${API}/api/streak`).then(r => r.json()).catch(() => ({streak:0})),
                    fetch(`${API}/api/goals`).then(r => r.json()).catch(() => ({water:8, stand:6, exercise:30})),
                    fetch(`${API}/api/settings`).then(r => r.json()).catch(() => ({})),
                    fetch(`${API}/api/sleep`).then(r => r.json()).catch(() => ({})),
                    fetch(`${API}/api/meal`).then(r => r.json()).catch(() => ({meals:[], total_calories:0})),
                    fetch(`${API}/api/mood`).then(r => r.json()).catch(() => ({})),
                    fetch(`${API}/api/achievements`).then(r => r.json()).catch(() => ({unlocked:[], stats:{}}))
                ]);
                goals = goalsR; settings = settingsR;
                updateUI(today, week, weight, streak, sleep, meal, mood, achieve);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch(e) { console.error(e); showToast('è¼‰å…¥å¤±æ•—', 'error'); }
        }
        
        function updateUI(t, w, wt, s, sl, ml, md, ach) {
            const now = new Date();
            document.getElementById('currentDate').textContent = `${now.getMonth()+1}/${now.getDate()} ${['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][now.getDay()]}`;
            document.getElementById('streakBadge').textContent = `ğŸ”¥ ${s.streak||0}å¤©`;
            const wc = t.water_count||0, sc = t.stand_count||0, em = t.exercise_minutes||0, ec = t.exercise_calories||0;
            document.getElementById('waterCount').textContent = wc;
            document.getElementById('standCount').textContent = sc;
            document.getElementById('exerciseMin').textContent = em;
            document.getElementById('caloriesBurn').textContent = ec;
            document.getElementById('waterGoal').textContent = goals.water;
            document.getElementById('standGoal').textContent = goals.stand;
            document.getElementById('exerciseGoal').textContent = goals.exercise;
            document.getElementById('waterProg').style.width = Math.min(wc/goals.water*100, 100) + '%';
            document.getElementById('standProg').style.width = Math.min(sc/goals.stand*100, 100) + '%';
            document.getElementById('exerciseProg').style.width = Math.min(em/goals.exercise*100, 100) + '%';
            document.getElementById('inputModifyWater').value = wc;
            document.getElementById('inputModifyStand').value = sc;
            document.getElementById('sleepHrs').textContent = sl.avg_hours || '-';
            document.getElementById('mealCal').textContent = ml.total_calories || 0;
            if (md.latest) { document.getElementById('moodEmoji').textContent = md.latest.emoji; document.getElementById('moodScore').textContent = md.latest.score + '/5'; }
            if (wt && wt.current) document.getElementById('weightVal').textContent = wt.current;
            renderWeek(w);
            document.getElementById('setWaterGoal').value = goals.water;
            document.getElementById('setStandGoal').value = goals.stand;
            document.getElementById('setExGoal').value = goals.exercise;
            document.getElementById('setWaterInt').value = settings.water_interval || 60;
            document.getElementById('setStandInt').value = settings.stand_interval || 45;
            document.getElementById('setDndStart').value = settings.dnd_start || '22:00';
            document.getElementById('setDndEnd').value = settings.dnd_end || '06:00';
            document.getElementById('toggleEnabled').classList.toggle('on', settings.enabled === 'TRUE' || settings.enabled === true);
            document.getElementById('sleepStats').innerHTML = sl.avg_hours ? `â° å¹³å‡ ${sl.avg_hours} å°æ™‚ | â­ å“è³ª ${sl.avg_quality}/5` : 'å°šç„¡è¨˜éŒ„';
            document.getElementById('mealList').innerHTML = ml.meals && ml.meals.length ? ml.meals.map(m => `<div class="meal-item"><span>${m.type}: ${m.foods}</span><span style="color:var(--gold)">${m.calories}å¡</span></div>`).join('') + `<div style="text-align:right;margin-top:8px;color:var(--gold)">ç¸½è¨ˆï¼š${ml.total_calories} å¤§å¡</div>` : 'å°šç„¡è¨˜éŒ„';
            document.getElementById('moodStats').innerHTML = md.avg_score ? `â­ å¹³å‡ ${md.avg_score}/5 | ğŸ“Š ${md.records||0} ç­†` : 'å°šç„¡è¨˜éŒ„';
            document.getElementById('achieveCount').textContent = `${ach.unlocked_count||0}/${ach.total||0}`;
            document.getElementById('achieveList').innerHTML = ach.unlocked && ach.unlocked.length ? ach.unlocked.map(a => `<span class="badge">${a.name}</span>`).join('') : '<div style="color:var(--gray)">å°šæœªè§£é–ï¼Œç¹¼çºŒåŠªåŠ›ï¼</div>';
            const st = ach.stats || {};
            document.getElementById('totalStats').innerHTML = `ğŸ’§ ${st.total_water||0} æ¯ | ğŸ§ ${st.total_stand||0} æ¬¡ | ğŸƒ ${st.total_exercise||0} åˆ†é˜<br>ğŸ”¥ é€£çºŒ ${st.streak||0} å¤©`;
            document.getElementById('refreshTime').textContent = `æ›´æ–°ï¼š${now.toLocaleTimeString('zh-TW')}`;
        }
        
        function renderWeek(w) {
            let html = '';
            (w || []).forEach(d => {
                const wh = Math.min((d.water||0)/goals.water*35, 35), sh = Math.min((d.stand||0)/goals.stand*35, 35), eh = Math.min((d.exercise||0)/goals.exercise*35, 35);
                html += `<div class="day-bar"><div class="bars"><div class="bar water" style="height:${wh}px"></div><div class="bar stand" style="height:${sh}px"></div><div class="bar exercise" style="height:${eh}px"></div></div><div class="weekday">${d.weekday}</div></div>`;
            });
            document.getElementById('weekBars').innerHTML = html;
        }
        
        async function quickLog(type) {
            try {
                const r = await fetch(`${API}/api/log/${type}`, {method:'POST'});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); loadData(); }
                else { showToast(d.error || 'å¤±æ•—', 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function logExercise() {
            const type = document.getElementById('exType').value, dur = parseInt(document.getElementById('exDuration').value) || 30;
            try {
                const r = await fetch(`${API}/api/log/exercise`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({type, duration:dur})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function qLogExercise() {
            const type = document.getElementById('qExType').value, dur = parseInt(document.getElementById('qExDur').value) || 30;
            try {
                const r = await fetch(`${API}/api/log/exercise`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({type, duration:dur})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); closeModal('exerciseModal'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function logSleep() {
            const h = parseFloat(document.getElementById('sleepInput').value), q = parseInt(document.getElementById('sleepQuality').value);
            if (!h || !q) { showToast('è«‹è¼¸å…¥æ™‚æ•¸å’Œå“è³ª', 'error'); return; }
            try {
                const r = await fetch(`${API}/api/log/sleep`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({hours:h, quality:q})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function qLogSleep() {
            const h = parseFloat(document.getElementById('qSleepH').value), q = parseInt(document.getElementById('qSleepQ').value);
            if (!h || !q) { showToast('è«‹è¼¸å…¥æ™‚æ•¸å’Œå“è³ª', 'error'); return; }
            try {
                const r = await fetch(`${API}/api/log/sleep`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({hours:h, quality:q})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); closeModal('sleepModal'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function logMeal() {
            const type = document.getElementById('mealType').value, foods = document.getElementById('mealFoods').value, cal = parseInt(document.getElementById('mealCalInput').value) || 0;
            if (!foods) { showToast('è«‹è¼¸å…¥é£Ÿç‰©', 'error'); return; }
            try {
                const r = await fetch(`${API}/api/log/meal`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({type, foods, calories:cal})});
                const d = await r.json();
                if (d.success) { showToast(`${d.message}`, 'success'); document.getElementById('mealFoods').value = ''; document.getElementById('mealCalInput').value = ''; loadData(); }
                else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function qLogMeal() {
            const type = document.getElementById('qMealType').value, foods = document.getElementById('qMealFoods').value;
            if (!foods) { showToast('è«‹è¼¸å…¥é£Ÿç‰©', 'error'); return; }
            try {
                const r = await fetch(`${API}/api/log/meal`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({type, foods, calories:0})});
                const d = await r.json();
                if (d.success) { showToast(`${d.message}`, 'success'); closeModal('mealModal'); document.getElementById('qMealFoods').value = ''; loadData(); }
                else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        function selectMood(m) { selectedMood = m; document.querySelectorAll('#tab-health .mood-btn').forEach(b => b.classList.toggle('selected', b.dataset.mood === m)); }
        
        async function logMood() {
            const note = document.getElementById('moodNote').value;
            try {
                const r = await fetch(`${API}/api/log/mood`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({emoji:selectedMood, note})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); document.getElementById('moodNote').value = ''; loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function qLogMood(m) {
            try {
                const r = await fetch(`${API}/api/log/mood`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({emoji:m, note:''})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); closeModal('moodModal'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function qLogWeight() {
            const w = parseFloat(document.getElementById('qWeight').value);
            if (!w) { showToast('è«‹è¼¸å…¥é«”é‡', 'error'); return; }
            try {
                const r = await fetch(`${API}/api/log/weight`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({weight:w})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); closeModal('weightModal'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        // ä¿®æ”¹å–æ°´ - ç¨ç«‹å‡½æ•¸
        async function modifyWater() {
            const count = parseInt(document.getElementById('inputModifyWater').value);
            if (isNaN(count) || count < 0) { showToast('è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—', 'error'); return; }
            try {
                const r = await fetch(`${API}/api/modify/water`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({count})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        // ä¿®æ”¹èµ·èº« - ç¨ç«‹å‡½æ•¸
        async function modifyStand() {
            const count = parseInt(document.getElementById('inputModifyStand').value);
            if (isNaN(count) || count < 0) { showToast('è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—', 'error'); return; }
            try {
                const r = await fetch(`${API}/api/modify/stand`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({count})});
                const d = await r.json();
                if (d.success) { showToast(d.message, 'success'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function saveGoals() {
            const w = parseInt(document.getElementById('setWaterGoal').value), s = parseInt(document.getElementById('setStandGoal').value), e = parseInt(document.getElementById('setExGoal').value);
            try {
                const r = await fetch(`${API}/api/update/goals`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({water:w, stand:s, exercise:e})});
                const d = await r.json();
                if (d.success) { showToast('ç›®æ¨™å·²å„²å­˜', 'success'); loadData(); } else { showToast(d.error, 'error'); }
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function saveSettings() {
            const wi = parseInt(document.getElementById('setWaterInt').value), si = parseInt(document.getElementById('setStandInt').value), ds = document.getElementById('setDndStart').value, de = document.getElementById('setDndEnd').value;
            try {
                await fetch(`${API}/api/update/settings`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({water_interval:wi, stand_interval:si, dnd_start:ds, dnd_end:de})});
                showToast('è¨­å®šå·²å„²å­˜', 'success'); loadData();
            } catch(e) { showToast('ç¶²è·¯éŒ¯èª¤', 'error'); }
        }
        
        async function toggleEnabled() {
            const toggle = document.getElementById('toggleEnabled'), val = !toggle.classList.contains('on');
            toggle.classList.toggle('on', val);
            try {
                await fetch(`${API}/api/update/settings`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({enabled:val})});
                showToast(val ? 'æé†’é–‹å•Ÿ' : 'æé†’é—œé–‰', 'success');
            } catch(e) { showToast('éŒ¯èª¤', 'error'); }
        }
        
        function showModal(id) { document.getElementById(id).classList.add('show'); }
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        function showToast(msg, type='') { const el = document.getElementById('toast'); el.textContent = msg; el.className = 'toast show ' + type; setTimeout(() => el.classList.remove('show'), 2500); }
        document.querySelectorAll('.modal').forEach(m => m.addEventListener('click', e => { if (e.target === m) m.classList.remove('show'); }));
        let startY = 0;
        document.addEventListener('touchstart', e => startY = e.touches[0].pageY);
        document.addEventListener('touchend', e => { if (window.scrollY === 0 && e.changedTouches[0].pageY - startY > 80) loadData(); });
        loadData();
        setInterval(loadData, 180000);
    </script>
</body>
</html>
